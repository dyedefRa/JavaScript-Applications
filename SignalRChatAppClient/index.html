<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles/bootstrap.min.css">
    <link rel="stylesheet" href="styles/style.css">

</head>

<body>
    <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-10">
            <div class="row">
                <div class="col-md-3">
                    <input type="text" class="form-control form-control-lg disabled" placeholder="Oda adı.">
                    <button type="button" class="btn btn-info rightButton disabled">Oda Oluştur</button>
                    <select size="5" style="width: 100%;" class="form-select disabled" multiple>
                    <option selected value="-1">Odalar</option>
                    </select>
                    <button type="button" class="btn btn-primary rightButton disabled">Seçili Odalara Gir</button>
                    <!-- ODALAR -->
                    <br> <br> <br>

                    <!-- Clientlar -->

                    <div class="list-group" id="clients">
                        <a class="list-group-item list-group-item-action users active">Tümü</a>
                        <div id="_clients"></div>

                    </div>
                    <!-- Clientlar -->
                </div>
                <div class="col-md-6">
                    <!-- Mesajlaşma -->
                    <div class="alert alert-success" id="clientDurum" style="display: none;">

                    </div>

                    <textarea name="" id="" cols="30" rows="3" class="form-control" style="margin-top: 5px;" placeholder="İletilecek mesajı buraya giriniz."></textarea>

                    <button type="button" class="btn btn-light rightButton" id="btnSend">Gönder</button>

                    <br> <br> <br>

                    <div class="list-group">
                        <a href="" class="list-group-item list-group-item-action" aria-current="true">
                            <div class="d-flex w-100 justify-context-between">
                                <h5 class="mb-1">Ahmet</h5>
                                <h5 class="mb-2">Sen</h5>
                            </div>
                            <p class="mb-1"> Test içerik</p>
                            <small>Test içerik2</small>
                        </a>
                    </div>
                </div>
                <div class="col-md-3">
                    <input class="form-control form-control-lg" type="text" placeholder="Adınız/Nick" id="txtNickName">
                    <button type="button" class="btn btn-success leftButton" id="btnLogin">Giriş Yap</button>
                </div>
            </div>
        </div>
        <div class="col-md-1"></div>
    </div>


</body>
<script src="/scripts/signalr.min.js"></script>
<script src="/scripts/jquery.min.js"></script>
<script src="/scripts/bootstrap.min.js"></script>
<script>
    $(document).ready(() => {
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("https://localhost:44344/chathub")
            .build();
        connection.start();

        const divStatus = $('#clientDurum');

        function myAnimate() {
            divStatus.fadeIn(2000, () => {
                divStatus.fadeOut(2000);
            }, 2000);
        }

        $(".disabled").attr("disabled", "disabled");

        $("body").on("click", ".users", function() {
            $(".users").each((index, item) => {
                item.classList.remove("active");
            });
            $(this).addClass("active");
        });
        $("#btnSend").click(() => {
            var x = $(".message").clone();
            x.removeClass("message");
            x.find("h5")[1].innerHTML = ""; //Ahmeti gösterir
            x.find("h5")[0].innerHTML = ""; //Seni gçsterir
            $(".message").append(x);
        });

        //Kullanıcıyı Login edelim ve ardından bu method servera gidip alttaki methodları cagırsın
        $("#btnLogin").click(() => {
            var nickName = $("#txtNickName").val();
            connection.invoke("GetNickName", nickName)
                .catch(err =>
                    console.log(err));
            $(".disabled").removeAttr("disabled");

        });

        connection.on("clientJoined", nickName => {
            console.log("clientJoinde");
            $("#clientDurum").html(`${nickName} giriş yaptı.`);
            $("#clientDurum").fadeIn(2000, () => {
                setTimeout(() => {
                    $("#clientDurum").fadeOut(2000);
                }, 2000)
            });
        });

        connection.on("allClients", clients => {
            $("#_clients").html("");
            $.each(clients, (index, item) => {
                const user = $(".users").first().clone();
                user.removeClass("active");
                user.html(item.nickName);
                $("#_clients").append(user);
            });

        });



    });
</script>

</html>